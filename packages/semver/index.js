"use strict";
/**
 * Created by user on 2019/3/29.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const moment = require("moment");
/**
 * create a idea style semver (190.1.329002)
 */
function date(old, options = {}) {
    let now = moment();
    let patch = 1;
    let major = options.major | 0;
    let minor = options.minor | 0;
    if (options.style == null) {
        options.style = 1 /* IDEA */;
    }
    let _v1 = date.parse(old, options);
    if (!major && _v1) {
        major = _v1[4] | 0;
    }
    if (!minor && _v1) {
        minor = _v1[5] | 0;
    }
    let _v2;
    let timestamp = options.timestamp;
    if (typeof timestamp === 'string') {
        _v2 = date.parse(timestamp, options);
        if (_v2) {
            timestamp = [_v2[0], _v2[1] - 1, _v2[2]];
            if (!major) {
                major = _v2[4] | 0;
            }
            if (!minor) {
                minor = _v2[5] | 0;
            }
        }
    }
    timestamp = moment(timestamp || now);
    if (!timestamp.isValid()) {
        throw new RangeError(`timestamp not a valid date: ${timestamp}`);
    }
    if (_v1) {
        if (!_v2) {
            _v2 = [timestamp.year(), timestamp.month() + 1, timestamp.date(), 0, major, minor];
        }
        if (_v1[0] === _v2[0] && _v1[1] === _v2[1] && _v1[2] === _v2[2]) {
            patch = Math.max(_v2[3], _v1[3], 1) + 1;
        }
        else if (_v2[3]) {
            patch = Math.max(_v2[3], 1) + 1;
        }
    }
    let yf = options.style ? `YY` : `YYYY`;
    major = String(major || 0).padStart(options.padZero, '0');
    patch = String(patch).padStart(3, '0');
    return timestamp.format(`${yf}${major}.${minor}.MDD${patch}`);
}
exports.date = date;
(function (date) {
    function parse(version, options = {}) {
        if (typeof version === 'string') {
            if (options.style == null) {
                options.style = 1 /* IDEA */;
            }
            if (options.style) {
                if (version.match(/^(\d{2})(\d*)\.(\d+)\.(\d)(\d{2})(\d*)$/)) {
                    // @ts-ignore
                    return [(RegExp.$1 | 0) + 2000, RegExp.$4, RegExp.$5, RegExp.$6, RegExp.$2, RegExp.$3].map(v => v | 0);
                }
                return null;
            }
            if (version.match(/^(\d{4})(\d*)\.(\d+)\.(\d)(\d{2})(\d*)$/)) {
                // @ts-ignore
                return [RegExp.$1, RegExp.$4, RegExp.$5, RegExp.$6, RegExp.$2, RegExp.$3].map(v => v | 0);
            }
        }
        return null;
    }
    date.parse = parse;
})(date = exports.date || (exports.date = {}));
exports.default = date;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsaUNBQWtDO0FBaUJsQzs7R0FFRztBQUNILFNBQWdCLElBQUksQ0FBQyxHQUFZLEVBQUUsVUFBb0IsRUFBRTtJQUV4RCxJQUFJLEdBQUcsR0FBRyxNQUFNLEVBQUUsQ0FBQztJQUNuQixJQUFJLEtBQUssR0FBb0IsQ0FBQyxDQUFDO0lBQy9CLElBQUksS0FBSyxHQUFxQixPQUFPLENBQUMsS0FBZ0IsR0FBRyxDQUFDLENBQUM7SUFDM0QsSUFBSSxLQUFLLEdBQXFCLE9BQU8sQ0FBQyxLQUFnQixHQUFHLENBQUMsQ0FBQztJQUUzRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksSUFBSSxFQUN6QjtRQUNDLE9BQU8sQ0FBQyxLQUFLLGVBQTJCLENBQUM7S0FDekM7SUFFRCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUVuQyxJQUFJLENBQUMsS0FBSyxJQUFJLEdBQUcsRUFDakI7UUFDQyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNuQjtJQUVELElBQUksQ0FBQyxLQUFLLElBQUksR0FBRyxFQUNqQjtRQUNDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ25CO0lBRUQsSUFBSSxHQUFrQyxDQUFDO0lBRXZDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFFbEMsSUFBSSxPQUFPLFNBQVMsS0FBSyxRQUFRLEVBQ2pDO1FBQ0MsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXJDLElBQUksR0FBRyxFQUNQO1lBQ0MsU0FBUyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFF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LENBQUMsQ0FBQyxFQUFFLENBQUUsQ0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFBO2lCQUMvRztnQkFFRCxPQUFPLElBQUksQ0FBQzthQUNaO1lBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLHlDQUF5QyxDQUFDLEVBQzVEO2dCQUNDLGFBQWE7Z0JBQ2IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUUsQ0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFBO2FBQ2xHO1NBQ0Q7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUE5QmUsVUFBSyxRQThCcEIsQ0FBQTtBQUNGLENBQUMsRUFqQ2dCLElBQUksR0FBSixZQUFJLEtBQUosWUFBSSxRQWlDcEI7QUFFRCxrQkFBZSxJQUFJLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENyZWF0ZWQgYnkgdXNlciBvbiAyMDE5LzMvMjkuXG4gKi9cblxuaW1wb3J0IG1vbWVudCA9IHJlcXVpcmUoXCJtb21lbnRcIik7XG5cbmV4cG9ydCBjb25zdCBlbnVtIEVudW1TZW12ZXJEYXRlU3R5bGVcbntcblx0WUVBUiA9IDAsXG5cdElERUEgPSAxXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU9wdGlvbnNcbntcblx0dGltZXN0YW1wPzogbW9tZW50Lk1vbWVudElucHV0IHwgbW9tZW50Lk1vbWVudCxcblx0bWFqb3I/OiBudW1iZXIgfCBzdHJpbmcsXG5cdG1pbm9yPzogbnVtYmVyIHwgc3RyaW5nLFxuXHRwYWRaZXJvPzogbnVtYmVyO1xuXHRzdHlsZT86IEVudW1TZW12ZXJEYXRlU3R5bGVcbn1cblxuLyoqXG4gKiBjcmVhdGUgYSBpZGVhIHN0eWxlIHNlbXZlciAoMTkwLjEuMzI5MDAyKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGF0ZShvbGQ/OiBzdHJpbmcsIG9wdGlvbnM6IElPcHRpb25zID0ge30pXG57XG5cdGxldCBub3cgPSBtb21lbnQoKTtcblx0bGV0IHBhdGNoOiBzdHJpbmcgfCBudW1iZXIgPSAxO1xuXHRsZXQgbWFqb3I6IHN0cmluZyB8IG51bWJlciA9IChvcHRpb25zLm1ham9yIGFzIG51bWJlcikgfCAwO1xuXHRsZXQgbWlub3I6IHN0cmluZyB8IG51bWJlciA9IChvcHRpb25zLm1pbm9yIGFzIG51bWJlcikgfCAwO1xuXG5cdGlmIChvcHRpb25zLnN0eWxlID09IG51bGwpXG5cdHtcblx0XHRvcHRpb25zLnN0eWxlID0gRW51bVNlbXZlckRhdGVTdHlsZS5JREVBO1xuXHR9XG5cblx0bGV0IF92MSA9IGRhdGUucGFyc2Uob2xkLCBvcHRpb25zKTtcblxuXHRpZiAoIW1ham9yICYmIF92MSlcblx0e1xuXHRcdG1ham9yID0gX3YxWzRdIHwgMDtcblx0fVxuXG5cdGlmICghbWlub3IgJiYgX3YxKVxuXHR7XG5cdFx0bWlub3IgPSBfdjFbNV0gfCAwO1xuXHR9XG5cblx0bGV0IF92MjogUmV0dXJuVHlwZTx0eXBlb2YgZGF0ZS5wYXJzZT47XG5cblx0bGV0IHRpbWVzdGFtcCA9IG9wdGlvbnMudGltZXN0YW1wO1xuXG5cdGlmICh0eXBlb2YgdGltZXN0YW1wID09PSAnc3RyaW5nJylcblx0e1xuXHRcdF92MiA9IGRhdGUucGFyc2UodGltZXN0YW1wLCBvcHRpb25zKTtcblxuXHRcdGlmIChfdjIpXG5cdFx0e1xuXHRcdFx0dGltZXN0YW1wID0gW192MlswXSwgX3YyWzFdIC0gMSwgX3YyWzJdXTtcblxuXHRcdFx0aWYgKCFtYWpvcilcblx0XHRcdHtcblx0XHRcdFx0bWFqb3IgPSBfdjJbNF0gfCAwO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIW1pbm9yKVxuXHRcdFx0e1xuXHRcdFx0XHRtaW5vciA9IF92Mls1XSB8IDA7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0dGltZXN0YW1wID0gbW9tZW50KHRpbWVzdGFtcCB8fCBub3cpIGFzIG1vbWVudC5Nb21lbnQ7XG5cblx0aWYgKCF0aW1lc3RhbXAuaXNWYWxpZCgpKVxuXHR7XG5cdFx0dGhyb3cgbmV3IFJhbmdlRXJyb3IoYHRpbWVzdGFtcCBub3QgYSB2YWxpZCBkYXRlOiAke3RpbWVzdGFtcH1gKTtcblx0fVxuXG5cdGlmIChfdjEpXG5cdHtcblx0XHRpZiAoIV92Milcblx0XHR7XG5cdFx0XHRfdjIgPSBbdGltZXN0YW1wLnllYXIoKSwgdGltZXN0YW1wLm1vbnRoKCkgKyAxLCB0aW1lc3RhbXAuZGF0ZSgpLCAwLCBtYWpvciwgbWlub3JdO1xuXHRcdH1cblxuXHRcdGlmIChfdjFbMF0gPT09IF92MlswXSAmJiBfdjFbMV0gPT09IF92MlsxXSAmJiBfdjFbMl0gPT09IF92MlsyXSlcblx0XHR7XG5cdFx0XHRwYXRjaCA9IE1hdGgubWF4KF92MlszXSwgX3YxWzNdLCAxKSArIDE7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKF92MlszXSlcblx0XHR7XG5cdFx0XHRwYXRjaCA9IE1hdGgubWF4KF92MlszXSwgMSkgKyAxO1xuXHRcdH1cblx0fVxuXG5cdGxldCB5ZiA9IG9wdGlvbnMuc3R5bGUgPyBgWVlgIDogYFlZWVlgO1xuXG5cdG1ham9yID0gU3RyaW5nKG1ham9yIHx8IDApLnBhZFN0YXJ0KG9wdGlvbnMucGFkWmVybywgJzAnKTtcblx0cGF0Y2ggPSBTdHJpbmcocGF0Y2gpLnBhZFN0YXJ0KDMsICcwJylcblxuXHRyZXR1cm4gdGltZXN0YW1wLmZvcm1hdChgJHt5Zn0ke21ham9yfS4ke21pbm9yfS5NREQke3BhdGNofWApXG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgZGF0ZVxue1xuXHRleHBvcnQgZnVuY3Rpb24gcGFyc2UodmVyc2lvbjogc3RyaW5nLFxuXHRcdG9wdGlvbnM6IElPcHRpb25zID0ge30sXG5cdCk6IFtudW1iZXIgLyp5ZWFyKi8sIG51bWJlciAvKnllYXIqLywgbnVtYmVyIC8qbW9udGgqLywgbnVtYmVyIC8qZGF0ZSovLCBudW1iZXIgLyptYWpvciovLCBudW1iZXIgLyptaW5vciovXVxuXHR7XG5cdFx0aWYgKHR5cGVvZiB2ZXJzaW9uID09PSAnc3RyaW5nJylcblx0XHR7XG5cdFx0XHRpZiAob3B0aW9ucy5zdHlsZSA9PSBudWxsKVxuXHRcdFx0e1xuXHRcdFx0XHRvcHRpb25zLnN0eWxlID0gRW51bVNlbXZlckRhdGVTdHlsZS5JREVBO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAob3B0aW9ucy5zdHlsZSlcblx0XHRcdHtcblx0XHRcdFx0aWYgKHZlcnNpb24ubWF0Y2goL14oXFxkezJ9KShcXGQqKVxcLihcXGQrKVxcLihcXGQpKFxcZHsyfSkoXFxkKikkLykpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQvLyBAdHMtaWdub3JlXG5cdFx0XHRcdFx0cmV0dXJuIFsoUmVnRXhwLiQxIHwgMCkgKyAyMDAwLCBSZWdFeHAuJDQsIFJlZ0V4cC4kNSwgUmVnRXhwLiQ2LCBSZWdFeHAuJDIsIFJlZ0V4cC4kM10ubWFwKHYgPT4gKHYgYXMgYW55KSB8IDApXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHZlcnNpb24ubWF0Y2goL14oXFxkezR9KShcXGQqKVxcLihcXGQrKVxcLihcXGQpKFxcZHsyfSkoXFxkKikkLykpXG5cdFx0XHR7XG5cdFx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdFx0cmV0dXJuIFtSZWdFeHAuJDEsIFJlZ0V4cC4kNCwgUmVnRXhwLiQ1LCBSZWdFeHAuJDYsIFJlZ0V4cC4kMiwgUmVnRXhwLiQzXS5tYXAodiA9PiAodiBhcyBhbnkpIHwgMClcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxufVxuXG5leHBvcnQgZGVmYXVsdCBkYXRlXG4iXX0=